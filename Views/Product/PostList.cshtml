@{
    ViewBag.Title = "商品管理";
}

<div class="container">
    <br /><h4>商品管理</h4><br />

    <section class="well">
        <div class="form-group row">
            <label class="col-lg-2">類型</label>
            <div class="col-lg-2">
                <v-select v-model="model.Category" :options="productCategories" :blank="true" />
            </div>

            <label class="col-lg-2">產品名稱</label>
            <div class="col-lg-2">
                <input class="form-control" v-model="model.Name" />
            </div>
        </div>

        <div class="form-group row">
            <label class="col-lg-2">型號</label>
            <div class="col-lg-2">
                <input class="form-control" v-model="model.Mold" />
            </div>
            <div class="col-lg-offset-6">
                <button type="button" class="btn btn-primary" v-on:click="getData();">查詢</button>
            </div>
        </div>
    </section>
    <div>
        <input type="button" class="btn btn-warning" value="新增商品" onclick="location.href='/Product/PostCreate'" />
    </div>
    <datatable :columns="columns" :data="rows"></datatable>
    <datatable-pager v-model="page" type="abbreviated" class="d-flex justify-content-center"></datatable-pager>
</div>
<script src="~/js/backendBundle.js"></script>


<script type="text/javascript">
    
    @await Component.InvokeAsync("EnumsToJavaScript")

var vm =
    new Vue({
        el: '.container',
        data: {
            columns: [
                {
                    label: "操作", interpolate: true, align: "center", sortable: false,
                    representedAs: function (row) {
                        return editDeleteButton("/Product/PostEdit/", "/Product/PostDelete/", row.Id);
                    }
                },
                {
                    label: "類型", interpolate: true,
                    representedAs: function (row) { 
                        return ddlDescription(ProductCategory, row.Category);
                    }
                },
                { label: "產品名稱", field: "Name" },
                { label: "型號", field: "Mold" },
                { label: "說明", field: "Description" }
            ],
            rows: [],
            model: {},
            page: 1,
            productCategories: ProductCategory
        },
        mounted: function () {
            window.addEventListener('keypress', function (event) {
                if (event.key == "Enter") {
                    vm.getData();
                }
            });
        },
        methods: {
            getData() {
                blockUI();

                axios.get('/Product/PostGrid', {
                    params: this.model
                })
                .then(response => {
                    //alert(JSON.stringify(response.data));
                    this.rows = response.data;
                    $.unblockUI();
                });
            }
        },
        created() {
            this.getData();
        }
    });
</script>
