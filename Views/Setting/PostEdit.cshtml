@{
    ViewBag.Title = "編輯商品";
}

<div class="container">
    <br /><h4>編輯商品</h4>
    <!-- 畫面驗證訊息 -->
    <div class='validation-summary-errors'><ul /></div>

    <div class="form-group row">
        <label class="col-lg-2 text-right"><span style="color: red">＊</span>類型</label>
        <div class="col-lg-4">
            <v-select v-model="model.Category" :options="productCategories" :blank="true" />
        </div>
    </div>

    <div class="form-group row">
        <label class="col-lg-2 text-right"><span style="color: red">＊</span>產品名稱</label>
        <div class="col-lg-4">
            <input class="form-control" v-model="model.Name" />
        </div>
    </div>

    <div class="form-group row">
        <label class="col-lg-2 text-right"><span style="color: red">＊</span>型號</label>
        <div class="col-lg-4">
            <input class="form-control" v-model="model.Mold" />
        </div>
    </div>

    <div class="form-group row">
        <label class="col-lg-2 text-right">說明</label>
        <div class="col-lg-4">
            <textarea class="form-control" v-model="model.Description" rows="3" cols="10"></textarea>
        </div>
    </div>

    <div class="form-group row">
        <label class="col-lg-2 text-right"><span style="color: red">＊</span>圖片</label>
        <div class="col-lg-4">
            <input type="file" class="filestyle" v-on:change="fileChange($event, 'Path')" v-bind:data-placeholder="model.Path" /><br />
            <img v-bind:src="'/images/Post/' + model.Path" v-if="!previewImage[0] && !!model.Path" class="w-100"/>
            <span v-show="!!previewImage[0]">
                <img v-bind:src="previewImage[0]" class="w-100"/>
            </span>
        </div>
    </div>

    <div class="card w-75">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#Function" aria-selected="true">功能</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#Recipe" aria-selected="false">食譜</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#Design" aria-selected="false">設計</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#Story" aria-selected="false">故事</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#Spec" aria-selected="false">規格</a>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="Function">
                    <div class="form-group row">
                        <label class="col-lg-2 text-right">標題</label>
                        <div class="col-lg-6">
                            <input class="form-control" v-model="model.FunctionTitle" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">說明</label>
                        <div class="col-lg-6">
                            <textarea class="form-control" v-model="model.FunctionDescription" rows="3" cols="10"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">圖片</label>
                        <div class="col-lg-6">
                            <input type="file" class="filestyle" v-on:change="fileChange($event, 'FunctionPath')" v-bind:data-placeholder="model.FunctionPath" /><br />
                            <img v-bind:src="'/images/Post/' + model.FunctionPath" v-if="!previewImage[1] && !!model.FunctionPath" class="w-100" />
                            <span v-show="!!previewImage[1]">
                                <img v-bind:src="previewImage[1]" class="w-100" />
                            </span>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="Recipe">
                    <div class="form-group row">
                        <label class="col-lg-2 text-right">標題</label>
                        <div class="col-lg-6">
                            <input class="form-control" v-model="model.RecipeTitle" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">說明</label>
                        <div class="col-lg-6">
                            <textarea class="form-control" v-model="model.RecipeDescription" rows="3" cols="10"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">圖片</label>
                        <div class="col-lg-6">
                            <input type="file" class="filestyle" v-on:change="fileChange($event, 'RecipePath')" v-bind:data-placeholder="model.RecipePath" /><br />
                            <img v-bind:src="'/images/Post/' + model.RecipePath" v-if="!previewImage[2] && !!model.RecipePath" class="w-100" />
                            <span v-show="!!previewImage[2]">
                                <img v-bind:src="previewImage[2]" class="w-100" />
                            </span>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="Design">
                    <div class="form-group row">
                        <label class="col-lg-2 text-right">標題</label>
                        <div class="col-lg-6">
                            <input class="form-control" v-model="model.DesignTitle" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">說明</label>
                        <div class="col-lg-6">
                            <textarea class="form-control" v-model="model.DesignDescription" rows="3" cols="10"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">圖片</label>
                        <div class="col-lg-6">
                            <input type="file" class="filestyle" v-on:change="fileChange($event, 'DesignPath')" v-bind:data-placeholder="model.DesignPath" /><br />
                            <img v-bind:src="'/images/Post/' + model.DesignPath" v-if="!previewImage[3] && !!model.DesignPath" class="w-100" />
                            <span v-show="!!previewImage[3]">
                                <img v-bind:src="previewImage[3]" class="w-100" />
                            </span>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="Story">
                    <div class="form-group row">
                        <label class="col-lg-2 text-right">標題</label>
                        <div class="col-lg-6">
                            <input class="form-control" v-model="model.StoryTitle" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">說明</label>
                        <div class="col-lg-6">
                            <textarea class="form-control" v-model="model.StoryDescription" rows="3" cols="10"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">圖片</label>
                        <div class="col-lg-6">
                            <input type="file" class="filestyle" v-on:change="fileChange($event, 'StoryPath')" v-bind:data-placeholder="model.StoryPath" /><br />
                            <img v-bind:src="'/images/Post/' + model.StoryPath" v-if="!previewImage[4] && !!model.StoryPath" class="w-100" />
                            <span v-show="!!previewImage[4]">
                                <img v-bind:src="previewImage[4]" class="w-100" />
                            </span>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="Spec">
                    <div class="form-group row">
                        <label class="col-lg-2 text-right">標題</label>
                        <div class="col-lg-6">
                            <input class="form-control" v-model="model.SpecTitle" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">說明</label>
                        <div class="col-lg-6">
                            <textarea class="form-control" v-model="model.SpecDescription" rows="3" cols="10"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-2 text-right">圖片</label>
                        <div class="col-lg-6">
                            <input type="file" class="filestyle" v-on:change="fileChange($event, 'SpecPath')" v-bind:data-placeholder="model.SpecPath" /><br />
                            <img v-bind:src="'/images/Post/' + model.SpecPath" v-if="!previewImage[5] && !!model.SpecPath" class="w-100" />
                            <span v-show="!!previewImage[5]">
                                <img v-bind:src="previewImage[5]" class="w-100" />
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <br />
    <div class="text-center">
        <input type="button" class="btn btn-primary" value="儲存" v-on:click="save" />
        <input type="button" class="btn btn-warning" value="上一頁" v-on:click="previousPage" />
    </div>
</div>

<script src="~/js/backendBundle.js"></script>

<script type="text/javascript">
    
    @await Component.InvokeAsync("EnumsToJavaScript")
    var vm = 
    new Vue({
        el: '.container',
        data: {
            model: @Html.Raw(Json.Serialize(Model)),
            errors: [],
            productCategories: ProductCategory,
            formdata: new FormData(),
            previewImage: ['', '', '', '', '', '']
        },
        methods: {
            fileChange: async function (e, type) {
                var files = e.target.files || e.dataTransfer.files;
                if (!files.length) { 
                    return;
                }

                vm.formdata.append(files[0].name, files[0]);

                await uploadFile(files[0]).then(function (file) {
                    vm.setPath(type, files[0].name, file);
                });
            },
            setPath(type, path, file) {
                if ("Path" == type) {
                    vm.model.Path = path;
                    vm.previewImage[0] = file
                } else if ("FunctionPath" == type) {
                    vm.model.FunctionPath = path;
                    vm.previewImage[1] = file;
                } else if ("RecipePath" == type) {
                    vm.model.RecipePath = path;
                    vm.previewImage[2] = file;
                } else if ("DesignPath" == type) {
                    vm.model.DesignPath = path;
                    vm.previewImage[3] = file;
                } else if ("StoryPath" == type) {
                    vm.model.StoryPath = path;
                    vm.previewImage[4] = file;
                } else if ("SpecPath" == type) {
                    vm.model.SpecPath = path;
                    vm.previewImage[5] = file;
                }
            },
            save() {
                // alert(JSON.stringify(this.model));
                ajaxUpload('/Product/PostEdit', this.model, '/Product/UploadImage/Post', this.formdata);
            }
        }
    })

</script>